<?php declare(strict_types=1); require 'config.php'; if ($_SERVER['REQUEST_METHOD'] !== 'POST') { http_response_code(405); echo json_encode(['errors' => ['Método no permitido']]); exit; } $username = isset($_POST['username']) ? trim((string)$_POST['username']) : ''; $email = isset($_POST['email']) ? trim((string)$_POST['email']) : ''; $password = isset($_POST['password']) ? $_POST['password'] : ''; $confirm = isset($_POST['confirm']) ? $_POST['confirm'] : ''; $errors = []; if ($username === '') $errors[] = 'Usuario es requerido'; if ($email === '' || !filter_var($email, FILTER_VALIDATE_EMAIL)) $errors[] = 'Email válido es requerido'; if ($password === '' || mb_strlen((string)$password) < 8) $errors[] = 'La contraseña debe tener al menos 8 caracteres'; if ($password !== $confirm) $errors[] = 'Las contraseñas no coinciden'; if (!empty($errors)) { http_response_code(400); echo json_encode(['errors' => $errors]); exit; } try { $pdo = dbConnect(); $stmt = $pdo->prepare('SELECT id FROM users WHERE username = :u OR email = :e'); $stmt->execute(['u'=>$username, 'e'=>$email]); if ($stmt->fetch()) { http_response_code(400); echo json_encode(['errors' => ['Usuario o correo ya registrados']]); exit; } $hash = password_hash($password, PASSWORD_BCRYPT); $stmt = $pdo->prepare('INSERT INTO users (username, email, password_hash) VALUES (:u, :e, :p)'); $stmt->execute(['u'=>$username, 'e'=>$email, 'p'=>$hash]); echo json_encode(['success' => true]); } catch (PDOException $e) { http_response_code(500); echo json_encode(['errors' => ['Error del servidor']]); } ?>